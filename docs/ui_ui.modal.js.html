<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ui/ui.modal.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">首页 Home</a></h2><h3>类Classes</h3><ul><li><a href="Gom.html">Gom</a></li><li><a href="Gom.App.html">App</a><ul class='methods'><li data-type='method'><a href="Gom.App.html#getCRO">getCRO</a></li><li data-type='method'><a href="Gom.App.html#getLastHashByLastIndex">getLastHashByLastIndex</a></li><li data-type='method'><a href="Gom.App.html#goto">goto</a></li><li data-type='method'><a href="Gom.App.html#run">run</a></li><li data-type='method'><a href="Gom.App.html#setCRO">setCRO</a></li></ul></li><li><a href="Gom.Page.html">Page</a><ul class='methods'><li data-type='method'><a href="Gom.Page.html#destory">destory</a></li><li data-type='method'><a href="Gom.Page.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.Page.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.Page.html#offview">offview</a></li><li data-type='method'><a href="Gom.Page.html#onview">onview</a></li><li data-type='method'><a href="Gom.Page.html#push">push</a></li><li data-type='method'><a href="Gom.Page.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.Page.html#render">render</a></li><li data-type='method'><a href="Gom.Page.html#setHeader">setHeader</a></li><li data-type='method'><a href="Gom.Page.html#setSeo">setSeo</a></li><li data-type='method'><a href="Gom.Page.html#show">show</a></li><li data-type='method'><a href="Gom.Page.html#update">update</a></li></ul></li><li><a href="Gom.Service.html">Service</a><ul class='methods'><li data-type='method'><a href="Gom.Service.html#ajax">ajax</a></li><li data-type='method'><a href="Gom.Service.html#fetch">fetch</a></li><li data-type='method'><a href="Gom.Service.html#get">get</a></li><li data-type='method'><a href="Gom.Service.html#post">post</a></li><li data-type='method'><a href="Gom.Service.html#save">save</a></li><li data-type='method'><a href="Gom.Service.html#tmpl">tmpl</a></li></ul></li><li><a href="Gom.UI.html">UI</a></li><li><a href="Gom.UI.Button.html">Button</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Button.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Button.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Button.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Button.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Button.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Button.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Button.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Button.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Button.html#update">update</a></li></ul></li><li><a href="Gom.UI.Header.html">Header</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Header.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Header.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Header.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Header.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Header.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Header.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Header.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Header.html#setTitle">setTitle</a></li><li data-type='method'><a href="Gom.UI.Header.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Header.html#update">update</a></li></ul></li><li><a href="Gom.UI.List.html">List</a><ul class='methods'><li data-type='method'><a href="Gom.UI.List.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.List.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.List.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.List.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.List.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.List.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.List.html#render">render</a></li><li data-type='method'><a href="Gom.UI.List.html#show">show</a></li><li data-type='method'><a href="Gom.UI.List.html#update">update</a></li></ul></li><li><a href="Gom.UI.Modal.html">Modal</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Modal.html#.alert">alert</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.bottom">bottom</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.center">center</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.confirm">confirm</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.layout">layout</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.loading">loading</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.top">top</a></li><li data-type='method'><a href="Gom.UI.Modal.html#autoHide">autoHide</a></li><li data-type='method'><a href="Gom.UI.Modal.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getType">getType</a></li><li data-type='method'><a href="Gom.UI.Modal.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Modal.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Modal.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Modal.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Modal.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Modal.html#toggleModal">toggleModal</a></li><li data-type='method'><a href="Gom.UI.Modal.html#update">update</a></li></ul></li><li><a href="Gom.UI.Scroll.html">Scroll</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Scroll.html#getSteps">getSteps</a></li><li data-type='method'><a href="Gom.UI.Scroll.html#scrollTo">scrollTo</a></li></ul></li><li><a href="Gom.UI.Select.html">Select</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Select.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Select.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Select.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Select.html#getSelect">getSelect</a></li><li data-type='method'><a href="Gom.UI.Select.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Select.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Select.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Select.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Select.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Select.html#update">update</a></li></ul></li><li><a href="Gom.UI.Sides.html">Sides</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Sides.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getSides">getSides</a></li><li data-type='method'><a href="Gom.UI.Sides.html#hide">hide</a></li><li data-type='method'><a href="Gom.UI.Sides.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Sides.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Sides.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Sides.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Sides.html#setContent">setContent</a></li><li data-type='method'><a href="Gom.UI.Sides.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Sides.html#update">update</a></li></ul></li><li><a href="Gom.UI.Slide.html">Slide</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Slide.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Slide.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Slide.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Slide.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Slide.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Slide.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Slide.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Slide.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Slide.html#update">update</a></li></ul></li><li><a href="Gom.UI.Toggle.html">Toggle</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Toggle.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#update">update</a></li></ul></li><li><a href="Gom.View.html">View</a><ul class='methods'><li data-type='method'><a href="Gom.View.html#destory">destory</a></li><li data-type='method'><a href="Gom.View.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.View.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.View.html#offview">offview</a></li><li data-type='method'><a href="Gom.View.html#onview">onview</a></li><li data-type='method'><a href="Gom.View.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.View.html#render">render</a></li><li data-type='method'><a href="Gom.View.html#show">show</a></li><li data-type='method'><a href="Gom.View.html#update">update</a></li></ul></li></ul><h3>命名空间 Namespaces</h3><ul><li><a href="store.html">store</a><ul class='methods'><li data-type='method'><a href="store.html#.del">del</a></li><li data-type='method'><a href="store.html#.del">del</a></li><li data-type='method'><a href="store.html#.each">each</a></li><li data-type='method'><a href="store.html#.get">get</a></li><li data-type='method'><a href="store.html#.has">has</a></li><li data-type='method'><a href="store.html#.noexpire">noexpire</a></li><li data-type='method'><a href="store.html#.size">size</a></li></ul></li><li><a href="url.html">url</a><ul class='methods'><li data-type='method'><a href="url.html#.getHashPath">getHashPath</a></li><li data-type='method'><a href="url.html#.getHashSearch">getHashSearch</a></li><li data-type='method'><a href="url.html#.getHTML5Hash">getHTML5Hash</a></li><li data-type='method'><a href="url.html#.getParams">getParams</a></li><li data-type='method'><a href="url.html#.getUrl">getUrl</a></li><li data-type='method'><a href="url.html#.set">set</a></li><li data-type='method'><a href="url.html#.setParam">setParam</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">ui/ui.modal.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(['View','Fx'], function(View) {
    var data = {
        type: 'loading', //alert, confirm, topup, top, bottom,
        btns: {
            yes: '确定',
            no:  '取消'
        },
        title: '',
        content: '',   //content为str或html,如果为function则需要返回str或html
        class: '',
        mask: true
    };
    var noop = function(){};
    /**
     * 弹层底层抽象类，如果需要自定义弹出层才需要用到, 自定义一般于Modal.layout，不满足才需要用到此类
     * 所有弹出层不可共存，但modal与toast可一起显示.
     *  @todo loading应该处理为可与其它弹出层共存
     *  @class Gom.UI.Modal
     *  @alias Modal
     *  @extends {Gom.View}
     *  @param {object} opts 传入的opts参数，会覆盖static默认参数
     *  @param {string} [opts.type]  自定义GomUI不存在的弹出层组件时才需要指定
     *  @param {string} [opts.title] 弹层标题
     *  @param {html|string} [opts.content] 弹层的html内部
     *  @param {string} [opts.class] 弹层自定义class
     *  @param {boolean} [opts.mask] 弹层是否显示遮罩
     *  @param {object} [opts.btns]  弹出层组件时按钮
     *  @param {string} [opts.btns.yes] 确定按钮名称
     *  @param {string} [opts.btns.no]  取消按钮名称
     *  @example opts对象可传入的有如下对象，如果opts为string时，则表示为opts.content
     *  {  type: '',  //在具体实例中已定义，扩展时可自定义名称
           btns: {
                yes: '确定',
                no:  '取消'
            },
            title: '',
            content: '',   //content为str或html,如果为function则需要返回str或html
            class: '',
            mask: true,
            onYes: function(){},
            onNo: function(){}
            }
     */
    var Modal = View.extend({
        init: function (opts) {
            opts.data = $.extend({}, data, opts.data);
            $.extend(opts, this);   //将List实例混合到opts上， 去父对象上执行
            opts.tmplname = 'ui.modal';
            opts.wrapper = opts.wrapper || '#modal';
            this._super(opts);
            this.onYes = opts.data.onYes || noop;
            this.onNo = opts.data.onNo || noop;
            this.mask = opts.data.mask;
        },
        /**
         * 显示弹层
         * @method Gom.UI.Modal#show
         */
        show: function (){
            this.wrapper.fadeIn(100);
            this.reloc();
            this.toggleModal();

            if(this.isToast()){
                this.autoHide();
            }
            if(this.mask !== true){
                $('.modal-overlay').removeClass('modal-overlay-visible');
            }
        },
        /**
         * 获取弹出层类型，即data.type
         * @method Gom.UI.Modal#getType
         */
        getType: function(){
            return this.data.type;
        },
        isToast: function(){
            return this.getType().indexOf('toast')!==-1;
        },
        isTopBot: function(){
            var type =  this.getType();
            var is = (type ==='top' || type==='bottom');
            if(is){return type}
            return is;
        },
        getModal: function(){
            return this.wrapper.find(this.isToast() ? '.modal-toast' : '.modal-layout');
        },
        /**
         * 判断显示与隐藏及相应动画
         * @method Gom.UI.Modal#toggleModal
         * @param {string} [inOrOut=In] in|显+out|隐
         * @desc 上下弹出层会采用slide+fade动画，其它采用scale+fade
         **/
        toggleModal: function(inout){
            inout = inout || 'In';
            var pos = this.isTopBot();
            if(pos){
                this['slide'+inout+'Modal'](pos);
            }else{
                this['scale'+inout+'Modal'](); //居中
            }
        },
        scaleInModal: function(){
            this.getModal().css({
                opacity: 0.2, transform: 'scale(1.5)'
            }).fx({
                opacity: 1, scale: 1
            }, 300, 'easeOutCirc');
        },
        scaleOutModal: function(){
            var that = this;
            this.getModal().fx({
                opacity: 0, scale: 0.2
            }, 300, 'easeOutCirc', function(){
                that.wrapper.hide();
            });
        },
        slideInModal: function(pos){
            var fxprops = {opacity: 1};
                fxprops[pos] = 0;
            this.getModal().fx(fxprops, 300, 'easeOutCirc');
        },
        slideOutModal: function(pos){
            var that = this;
            var fxprops = {opacity: 0};
                fxprops[pos] = -this.getModal().height();
            this.getModal().fx(fxprops, 300, 'easeOutCirc', function(){
                that.wrapper.hide();
            });
        },
        /**
         * 重置为动画前状态, 会根据modal所处的位置重置modal会置
         * @method Gom.UI.Modal#reloc
         * @private
         */
        reloc: function(){
            var ml = this.getModal(),  h = ml.height(), pos = this.isTopBot();
            var props = {}; props[pos] = -h;
            ml.css('height', h).css(pos ? props : {'margin-top': -h/2}); //居上|下 //居中
        },
        close: function(){
            this.wrapper.hide();
        },
        /**
         * 经过times millseconds 自动隐藏弹层
         * @method  Gom.UI.Modal#autoHide
         * @param {number} times 毫秒数
         */
        autoHide: function(times){
            var that = this;
            var time = setTimeout(function(){
                that.toggleModal('Out');
                clearTimeout(time);
            }, times);
        },
        events: {
            'click .modal-overlay': '_onNo',
            'click .modal-btn-yes': '_onYes',
            'click .modal-btn-no': '_onNo'
        },
        _onYes: function(){
            this.onYes();
            this.toggleModal('Out');
        },
        _onNo: function(){
            this.onNo();
            this.toggleModal('Out');
        }
    });

    var ModalExtend = {
        /**
         * 此方法一般用于自定义弹出层组件, 抽象类Modal的抽象实例
         * @method Gom.UI.Modal.layout
         * @param {object} static 默认参数
         * @param {object|string} opts 传入的opts参数为object时，会覆盖static默认参数, opts参数:@see Gom.UI.Modal#opts
         *                              传入的opts参数为string时，则表示为opts.content
         * @param {string} type 弹出层对象的名称
         *  opts对象可传入的有如下对象，如果opts为string时，则表示为opts.content
         * @return {Modal} 弹出层实例
         */
        layout: function(static, opts, type){
            var optsObj = {};
            if(typeof opts === 'string'){
                optsObj.content = opts;
            }else{
                optsObj = opts;
            }

            return new Modal({data: $.extend({}, static, optsObj, {type: type})});
        },
        /**
         * 显示警告框
         * @method Gom.UI.Modal.alert
         * @param {object|string} opts 传入的opts参数为object时，会覆盖static默认参数, opts参数:@see Gom.UI.Modal#opts
         *                              传入的opts参数为string时，则表示为opts.content
         * @return {Modal} 弹出层实例
         */
        alert:function(opts){
            var alertStatic = {
                title: opts.title || '警告:',
                btns: {
                    yes: 'OK'
                }
            };
            return this.layout(alertStatic, opts, 'alert').render();
        },
        /**
         * 显示对话框
         * @method Gom.UI.Modal.confirm
         * @param {object|string} opts 传入的opts参数为object时，会覆盖static默认参数, opts参数:@see Gom.UI.Modal#opts
         *                              传入的opts参数为string时，则表示为opts.content
         * @return {Modal} 弹出层实例
         */
        confirm:function(opts){
            var confirmStatic = {
                title: opts.title || '请确认:',
                btns: {
                    yes: '确定', no: '取消'
                }
            };
            return  this.layout(confirmStatic, opts, 'confirm').render();
        },
        /**
         * 显示loading
         * @method Gom.UI.Modal.loading
         */
        loading:function(){
            return new Modal({
                data:{
                    type: 'loading',
                    btns: false,
                    title: false,
                    mask: false
                }
            }).render();
        },
        /**
         * 显示对话框
         * @method Gom.UI.Modal.center
         * @param {object|string} opts 传入的opts参数为object时，会覆盖static默认参数, opts参数:@see Gom.UI.Modal#opts
         *                              传入的opts参数为string时，则表示为opts.content
         * @return {Modal} 弹出层实例
         */
        center:function(opts){
            var confirmStatic = {
                title: opts.title || '',
                btns: false
            };
            return  this.layout(confirmStatic, opts, 'center').render();
        },
        /**
         * 显示 top layout
         * @method Gom.UI.Modal.top
         * @param {object|string} opts 传入的opts参数为object时，会覆盖static默认参数, opts参数:@see Gom.UI.Modal#opts
         *                              传入的opts参数为string时，则表示为opts.content
         * @return {Modal} 弹出层实例
         */
        top: function(opts){
            var bottomStatic = {
                title: opts.title || '',
                btns: false,
            };
            return this.layout(bottomStatic, opts, 'top').render();
        },
        /**
         * 显示 bottom layout
         * @method Gom.UI.Modal.bottom
         * @param {object|string} opts 传入的opts参数为object时，会覆盖static默认参数, opts参数:@see Gom.UI.Modal#opts
         *                              传入的opts参数为string时，则表示为opts.content
         * @return {Modal} 弹出层实例
         */
        bottom: function(opts){
            //比如下面的时间选择器， ACTIONSHEET等
            var bottomStatic = {
                title: opts.title || '',
                btns: {
                    no: '取消',
                    yes: '完成'
                },
            };
            return this.layout(bottomStatic, opts, 'bottom').render();
        },
        popover: function(opts){
            var tipsStatic = {
                type: 'tips',
                btn: false,
                content: [{},{},{}]
            };
            return this.layout(tipsStatic, opts).render();
        },
        /**
         * 显示不同类型的弹出提示
         * @param {string} content 显示的内容;
         * @param {string} toastType 显示类别，有 warn info error, 默认info;
         * @return {Modal} 弹出层实例
         */
        toast: function(content, toastType){
            toastType = toastType || 'info';
            return new Modal({
                wrapper: '#toast',
                data:{
                    type: 'toast-'+toastType,
                    content: content,
                    btns: false,
                    title: false
                }
            }).render();
        }
    };
    return $.extend({}, {modal: Modal}, ModalExtend);
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Mon Dec 14 2015 18:51:05 GMT+0800 (中国标准时间) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
